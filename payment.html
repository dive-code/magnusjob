<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Magnus Payment</title>
<style>
  body { margin:0; font-family:"Poppins",Arial,sans-serif; background:#fff; color:#000; text-align:center; padding:20px; }
  .alert { background:#ff0000; color:#fff; padding:12px; border-radius:8px; font-weight:600; font-size:15px; box-shadow:0 0 15px rgba(255,0,0,0.3); margin-bottom:20px; animation:blink 1.5s infinite alternate; }
  @keyframes blink { from { opacity:1; } to { opacity:0.6; } }
  .card { background:#2d0052; color:#fff; padding:20px; border-radius:12px; margin:20px auto; max-width:420px; box-shadow:0 5px 20px rgba(0,0,0,0.2); }
  .card h2 { font-size:16px; color:#ffcc00; margin-bottom:8px; }
  .card h3 { font-size:18px; font-weight:bold; margin:8px 0; }
  .account-number { font-size:20px; font-weight:bold; margin:10px 0; }
  .account-name { font-size:15px; font-weight:bold; color:#ffcc00; margin-top:5px; }
  .note { font-size:13px; font-weight:bold; color:#ffcc00; margin-top:10px; line-height:1.6; }
  .copy-btn { display:inline-block; margin-left:10px; padding:6px 10px; font-size:12px; border:none; border-radius:6px; background:#ff9900; color:#fff; cursor:pointer; transition:0.15s; }
  .copy-btn:hover { background:#e68900; }
  .spinner { border:4px solid #ccc; border-top:4px solid #ff9900; border-radius:50%; width:50px; height:50px; animation:spin 1s linear infinite, pulse 2s ease-in-out infinite; margin:25px auto 10px; }
  @keyframes spin { 0% {transform:rotate(0deg);} 100% {transform:rotate(360deg);} }
  @keyframes pulse { 0%,100% { transform:scale(1); } 50% { transform:scale(1.1); } }
  .timer { font-weight:bold; color:#ff9900; font-size:16px; margin-top:5px; transition:color 0.5s ease; }
  .verify-section { margin-top:25px; }
  .verify-btn { display:block; width:100%; max-width:350px; margin:auto; padding:15px; border:none; border-radius:25px; background:#000; color:#fff; font-size:15px; font-weight:bold; cursor:pointer; text-decoration:none; transition:0.3s; }
  .verify-btn:hover { opacity:0.9; }
  footer { margin-top:25px; font-size:13px; color:#555; }
  #toast { position:fixed; bottom:25px; left:50%; transform:translateX(-50%); background:#000; color:#fff; padding:10px 15px; border-radius:8px; display:none; font-size:14px; }
  #debug { margin-top:15px; font-size:13px; color:#900; max-width:720px; margin-left:auto; margin-right:auto; text-align:left; display:none; padding:10px; border:1px dashed #900; border-radius:8px; background:#fff7f7; }
  .small { font-size:12px; color:#444; margin-top:6px; }
  .btn-success { background:#28a745 !important; }
</style>
</head>
<body>
  <div class="alert">
    ‚ö†Ô∏è Complete your payment within <b>10 minutes</b> to secure your Magnus registration. This page will refresh automatically if payment isn‚Äôt confirmed.
  </div>

  <p style="font-size:18px; font-weight:600; color:#333; margin-bottom:20px;">
    Transfer exactly <b>‚Ç¶11,000</b>, <b>‚Ç¶17,500</b>, or <b>‚Ç¶28,500</b> to any account below to complete your Magnus registration:
  </p>

  <div class="card">
    <h2>MERCHANT 1</h2>
    <h3>OPAY</h3>
    <p class="account-number">
      <span class="acct" data-account="6112282804">6112282804</span>
      <button class="copy-btn" data-account="6112282804">üìã Copy</button>
    </p>
    <p class="account-name">Lucy Abanum _magnus</p>
  </div>

  <div class="card">
    <h2>MERCHANT 2</h2>
    <h3>FCMB (First City Monument Bank)</h3>
    <p class="account-number">
      <span class="acct" data-account="1036388934">1036388934</span>
      <button class="copy-btn" data-account="1036388934">üìã Copy</button>
    </p>
    <p class="account-name">Divine Abanum</p>
    <p class="note">NOTE: Do not pay with Opay. Use PalmPay, FCMB, or other banks.</p>
  </div>

  <div class="spinner" aria-hidden="true"></div>
  <div class="timer">‚è≥ Time left: <span id="countdown">10:00</span></div>

  <div class="verify-section">
    <p>Click below to confirm your payment</p>
    <a href="https://wa.link/yx45yk" target="_blank" class="verify-btn">‚úÖ I have made the transfer</a>
  </div>

  <div id="toast">Copied!</div>

  <div id="debug"></div>

  <footer>¬© 2025 Magnus. All Rights Reserved.</footer>

<script>
(function(){
  // Debug helper: show messages on page for easy diagnosis
  const debugEl = document.getElementById('debug');
  function debug(msg, show = true) {
    console.log(msg);
    if (!show) return;
    debugEl.style.display = 'block';
    const p = document.createElement('div');
    p.textContent = new Date().toLocaleTimeString() + ' ‚Äî ' + msg;
    debugEl.appendChild(p);
  }

  // Robust copy function: try navigator.clipboard, fallback to textarea + execCommand
  async function doCopy(text) {
    // Prefer navigator.clipboard in secure contexts
    if (navigator.clipboard && navigator.clipboard.writeText) {
      try {
        await navigator.clipboard.writeText(text);
        debug('Copied to clipboard using navigator.clipboard: ' + text);
        return { ok: true, method: 'clipboard' };
      } catch (err) {
        debug('navigator.clipboard failed: ' + (err && err.message ? err.message : err));
        // fallback below
      }
    }

    // Fallback: create textarea and execCommand
    try {
      const ta = document.createElement('textarea');
      ta.value = text;
      // Make it non-visible to layout and focus
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.focus();
      ta.select();
      const res = document.execCommand('copy');
      document.body.removeChild(ta);
      if (res) {
        debug('Copied to clipboard using execCommand fallback: ' + text);
        return { ok: true, method: 'execCommand' };
      } else {
        debug('execCommand returned false (copy might have failed).');
        return { ok: false, method: 'execCommand' };
      }
    } catch (err) {
      debug('Fallback copy failed: ' + (err && err.message ? err.message : err));
      return { ok: false, method: 'none', error: err };
    }
  }

  // Toast UI
  const toast = document.getElementById('toast');
  function showToast(msg, success = true) {
    toast.textContent = (success ? '‚úÖ ' : '‚ö†Ô∏è ') + msg;
    toast.style.display = 'block';
    if (success) toast.classList.add('btn-success'); else toast.classList.remove('btn-success');
    setTimeout(() => toast.style.display = 'none', 1800);
  }

  // Wire up copy buttons (event listeners, not inline attributes)
  const copyButtons = Array.from(document.querySelectorAll('.copy-btn'));
  if (copyButtons.length === 0) debug('No copy buttons found on page.');
  copyButtons.forEach(btn => {
    btn.addEventListener('click', async (e) => {
      const acct = btn.getAttribute('data-account') || btn.dataset.account;
      if (!acct) {
        debug('Button has no data-account attribute.');
        showToast('Account not found', false);
        return;
      }
      // Attempt to copy
      try {
        const result = await doCopy(acct);
        if (result.ok) {
          showToast('Account copied: ' + acct, true);
        } else {
          showToast('Copy failed ‚Äî select & copy manually', false);
        }
      } catch (err) {
        debug('Unexpected error during copy: ' + (err && err.message ? err.message : err));
        showToast('Copy error ‚Äî open console', false);
      }
    });
  });

  // TIMER ‚Äî robust and guarded
  const countdownDisplay = document.getElementById('countdown');
  const timerEl = document.querySelector('.timer');

  if (!countdownDisplay) {
    debug('Countdown element not found ‚Äî timer will not run.');
  } else {
    let timeLeft = 600; // 10 minutes in seconds
    debug('Starting timer: ' + Math.floor(timeLeft/60) + ' minutes');

    // Ensure we don't start multiple intervals accidentally
    let timerId = null;
    function startTimer() {
      if (timerId !== null) {
        debug('Timer already running, not starting a new one.');
        return;
      }
      timerId = setInterval(() => {
        if (timeLeft < 0) timeLeft = 0;
        const minutes = Math.floor(timeLeft / 60);
        const seconds = timeLeft % 60;
        // Format with leading zeros
        const mm = String(minutes).padStart(2, '0');
        const ss = String(seconds).padStart(2, '0');
        countdownDisplay.textContent = ${mm}:${ss};

        // Color rules
        if (timeLeft <= 60) timerEl.style.color = '#ff0000';
        else if (timeLeft <= 180) timerEl.style.color = '#ff6600';
        else timerEl.style.color = '#ff9900';

        if (timeLeft <= 0) {
          clearInterval(timerId);
          timerId = null;
          countdownDisplay.textContent = '00:00';
          timerEl.textContent = 'üîÅ Session expired ‚Äî refreshing...';
          debug('Timer expired ‚Äî reloading in 2s');
          setTimeout(() => {
            try {
              location.reload();
            } catch (err) {
              debug('Reload blocked: ' + (err && err.message ? err.message : err));
            }
          }, 2000);
        }

        timeLeft--;
      }, 1000);
    }

    // Start after a short delay to let the page settle
    setTimeout(startTimer, 200);
  }

  // Safety: catch global errors and show them
  window.addEventListener('error', function (ev) {
    debug('Global error: ' + (ev && ev.message ? ev.message : JSON.stringify(ev)), true);
  });
  window.addEventListener('unhandledrejection', function (ev) {
    debug('Unhandled promise rejection: ' + (ev && ev.reason ? (ev.reason.message || JSON.stringify(ev.reason)) : JSON.stringify(ev)), true);
  });

  // Quick environment info (helps diagnose deployment issues)
  try {
    debug('Location origin: ' + (location && location.origin ? location.origin : 'unknown'));
    debug('Navigator userAgent: ' + navigator.userAgent, false);
    debug('Clipboard supported: ' + (!!(navigator.clipboard && navigator.clipboard.writeText)));
  } catch (e) {
    // ignore
  }

})();
</script>
</body>
</html>
